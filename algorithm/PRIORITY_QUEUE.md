# 优先级队列（二叉堆）

## 一、概念

优先级队列（二叉堆）实际是一种特殊的二叉树（完全二叉树），只不过一般存储在数组里。

### 1.1 堆的性质

1. 对于**最大堆**来讲： 堆中的任何节点的值都不小于其子节点的值。
2. 对于**最小堆**来讲： 堆中的任何节点的值都不大于其子节点的值。

假设在数组里面存储堆节点，则数组下标有如下关系：

* 父节点索引 = 子节点索引/2
* 左孩子索引 = 父节点索引*2
* 右孩子索引 = 父节点索引*2+1
> 数组的第一个索引0空着不用（one-based arrays）。
>
> 堆结构只能保证父节点和子节点的大小关系，并不能保证左右子节点之间的大小关系，如果需要保证左右节点之间的关系则需要考虑使用**二叉搜索树**。

堆结构节点索引关系在代码里面的体现如下：

```java
// 父节点索引
int parent(int node) {
	return node / 2;
}
// 左孩子索引
int leftChild(int node) {
  return node * 2;
}
// 右孩子索引
int rightChild(int node) {
  return node * 2 + 1;
}
```

在优先级队列中，**父节点的优先级高于子节点的优先级**。

## 二、两个重要的操作

对于维护堆结构（balancing a heap）来讲，有两个重要的操作，`shift-up` （上移）和 `shift-down`（下移）。

假设节点数值越大则优先级越高，也就是以最大堆来讲。在插入和删除元素时，难免破坏堆的性质，于是就需要通过这两个操作来恢复堆的特性了。对于最大堆来讲，破会堆性质的有两种情况：

1. 如果某个节点A比它的子节点小，那么A就不配做父节点，应该下去，把孩子节点中较大的拿上来做父节点，对于A来说这就是shift-down操作。
2. 如果某个节点A比它的父节点大，那么A就不该做子节点，应该上去，把父节点换下来，自己做父节点，对于A来说这就是shift-up操作。

